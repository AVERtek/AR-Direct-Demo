<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sugarlump Amazon Book - AR First, Sync Audio & Animation</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            position: relative;
            overflow: hidden;
        }
        model-viewer {
            width: 100%;
            height: 100vh;
            background-color: #ffffff;
            /* Ensure it fills the screen for AR immersion */
        }

        /* Container for the main controls (Play/Pause, Go to Book) */
        .main-controls-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        /* Styling for all buttons */
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        /* Specific styles for each button type */
        .ar-button {
            background-color: #007bff; /* Blue for AR */
            color: white;
        }
        .ar-button:hover {
            background-color: #0056b3;
        }

        .play-pause-button {
            background-color: #6f42c1; /* Purple for Play/Pause */
            color: white;
        }
        .play-pause-button:hover {
            background-color: #5a2e9b;
        }

        .url-button {
            background-color: #28a745; /* Green for URL */
            color: white;
        }
        .url-button:hover {
            background-color: #218838;
        }

        /* Message for PC users for AR */
        #ar-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2em;
            z-index: 20; /* Ensure it's above everything */
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>
    <div id="ar-message">
        This AR experience requires a mobile device.<br>
        Please open this page on your smartphone or tablet.
        <br><br>
        (The 3D model will appear below, but AR features are mobile-only.)
    </div>

    <model-viewer
        id="myModelViewer"
        src="Models/kindness_rocks_large_7.glb"
        ios-src="KINDNESS_ROCKS_LARGE_7_Output.usdz"
        alt="A 3D model"
        ar
        ar-modes="scene-viewer webxr quick-look"
        camera-controls
        poster="images/rocks.png"
        shadow-intensity="1"
        ar-scale="auto"
        ar-placement="floor"
        interaction-prompt="none"
        animation-name="Wave" autoplay="false" >
        <button slot="ar-button" id="ar-button" class="ar-button">Launch AR</button>
    </model-viewer>

    <audio id="audio" src="Sound/Kindness Rocks_mix.mp3" loop></audio>

    <div class="main-controls-container">
        <button id="playPauseButton" class="play-pause-button">Play Animation & Audio</button>
        <button id="url-button" class="url-button">Go to Book</button>
    </div>

    <script>
        const modelViewer = document.getElementById('myModelViewer');
        const playPauseButton = document.getElementById('playPauseButton');
        const urlButton = document.getElementById('url-button');
        const audio = document.getElementById('audio');
        const arMessage = document.getElementById('ar-message');
        const arButton = document.getElementById('ar-button'); // Reference to the slotted AR button

        let isPlaying = false; // Initial state: neither animation nor audio is playing

        // --- Device Detection (Simple) ---
        function isMobileDevice() {
            return /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   ('ontouchstart' in window && navigator.maxTouchPoints > 0);
        }

        // --- Unified Play/Pause Function ---
        function togglePlayPause() {
            if (isPlaying) {
                modelViewer.pause();
                audio.pause();
                playPauseButton.textContent = 'Play Animation & Audio';
            } else {
                modelViewer.play();
                // Check if audio can be played (user interaction often required for audio)
                audio.play().catch(error => {
                    console.warn("Audio play failed:", error);
                    // Inform user if audio requires interaction
                    // You might want to display a message like "Click to enable audio"
                });
                playPauseButton.textContent = 'Pause Animation & Audio';
            }
            isPlaying = !isPlaying;
        }

        // --- Initial Setup and Immediate AR Launch on Mobile / PC Message ---
        document.addEventListener('DOMContentLoaded', () => {
            if (isMobileDevice()) {
                // On mobile, hide the generic message
                arMessage.style.display = 'none';
                // Trigger AR immediately for mobile users
                // Note: activateAR() will attempt to launch AR. The actual AR session
                // starting and camera access might still require a user's explicit consent
                // or a "click" on the AR button by the user depending on browser/OS policies.
                modelViewer.activateAR();
            } else {
                // On PC, show the message and hide the AR button as it's not functional
                arMessage.style.display = 'block';
                arButton.style.display = 'none';
            }

            // Set initial play/pause button state
            playPauseButton.textContent = 'Play Animation & Audio';
        });

        // --- Event Listeners for Model Viewer and Controls ---

        // Play/Pause button click
        playPauseButton.addEventListener('click', togglePlayPause);

        // Model Viewer's 'play' event (e.g., if animation starts via other means)
        modelViewer.addEventListener('play', () => {
            // Ensure audio plays if model starts (and it's not already playing from our button)
            if (!isPlaying) { // Prevent re-triggering if our button already set isPlaying
                isPlaying = true;
                playPauseButton.textContent = 'Pause Animation & Audio';
                audio.play().catch(error => console.warn("Audio play failed on model.play event:", error));
            }
        });

        // Model Viewer's 'pause' event
        modelViewer.addEventListener('pause', () => {
            // Ensure audio pauses if model pauses (and it's not already paused from our button)
            if (isPlaying) { // Prevent re-triggering if our button already set isPlaying
                isPlaying = false;
                playPauseButton.textContent = 'Play Animation & Audio';
                audio.pause();
            }
        });

        // --- Crucial: Play animation and audio when AR session starts ---
        modelViewer.addEventListener('ar-status', (event) => {
            if (event.detail.status === 'session-started') {
                console.log('AR session started!');
                // Hide main controls and message during AR session for immersive experience
                playPauseButton.style.display = 'none';
                urlButton.style.display = 'block'; // Show URL button in AR
                arMessage.style.display = 'none'; // Ensure message is hidden

                // Immediately play animation and audio upon AR session start
                // This might still be subject to browser/OS autoplay policies for audio
                modelViewer.play();
                audio.play().catch(error => {
                    console.error("Audio play failed on AR session start:", error);
                    // Add a visible message to the user if audio doesn't auto-play
                    alert("Audio couldn't auto-play in AR. Please enable sound manually if needed.");
                });
                isPlaying = true; // Update global state
                playPauseButton.textContent = 'Pause Animation & Audio'; // Update button, though it's hidden

            } else if (event.detail.status === 'session-ended') {
                console.log('AR session ended.');
                // Show main controls again after AR session ends
                playPauseButton.style.display = 'block';
                urlButton.style.display = 'none'; // Hide URL button
                modelViewer.pause(); // Pause animation when leaving AR
                audio.pause(); // Pause audio when leaving AR
                isPlaying = false;
                playPauseButton.textContent = 'Play Animation & Audio';

                // If on PC, re-show the AR message
                if (!isMobileDevice()) {
                    arMessage.style.display = 'block';
                    arButton.style.display = 'none';
                }
            } else if (event.detail.status === 'not-ar-capable' && !isMobileDevice()) {
                // For desktop browsers that report not AR capable
                arMessage.style.display = 'block';
                arButton.style.display = 'none';
            }
            // For other ar-status like 'failed', 'error', etc., you might add more handling
        });

        // --- URL Button Logic ---
        urlButton.addEventListener('click', () => {
            const amazonUrl = "https://www.amazon.com/Sweet-Dreams-Sugarlump-childrens-everywhere/dp/B0FFZD7D12/ref=sr_1_1?crid=2PE5ZR31RUKFJ&dib=eyJ2IjoiMSJ9.eirXTPVo6volOV0M2LSzWYM7M7OETpDHtuB5kCsvMqZpHjvNE3fvrGYiQzi9OEE_KnGVoDwiK8TJUKsihTlWlEkYrzfe4QfSs8rE6vaoo0Y5BfWqKzpuFPGm7bKE9IC-Kz-0FvP462KBgxOa04D1aqfLppMInjk90QDppqNon6eTrQ0InDpeNmty3hB14QayZjes0oEcHGgvSH_4mtoM9SHyIbK9wzspljEyRdN_vAiF9SAFTutLx3FZqHy8JM44s5QDZ0XdYakBff_dMR3KMvFf10ZCsMFhMmGz6QY5jPI.EkEaYpKKTbUyJ3uJZG_vjHaGCtcX2MSHyN27dyNdIqY&dib_tag=se&keywords=sugarlump&qid=1752536576&sprefix=sugarlump%2Caps%2C158&sr=8-1'";
            window.open(amazonUrl, '_blank');
        });

    </script>
</body>
</html>



<!--<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>sugarlump Amazon Book</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>
  <style>
    #ar-button {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #url-button {
      display: none;
      position: absolute;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <model-viewer 
    src="Models/kindness_rocks_large_7.glb?sound=Sound/Kindness Rocks_mix.mp3" 
    ios-src="KINDNESS_ROCKS_LARGE_7_Output.usdz"
    alt="A 3D model" 
    ar 
    ar-modes="scene-viewer webxr quick-look" 
    camera-controls 
    auto-rotate 
    autoplay 
    poster="images/rocks.png" 
    shadow-intensity="1" 
    ar-scale="auto" 
    ar-placement="floor"
    interaction-prompt="none">
    <button slot="ar-button" id="ar-button">View in your space</button>
  </model-viewer>

  <audio id="audio" src="Sound/Kindness Rocks_mix.mp3" loop></audio>
  <button id="play-audio" onclick="document.getElementById('audio').play()">Play Audio</button>

  <button id="url-button" onclick="window.location.href='https://www.amazon.com/Sweet-Dreams-Sugarlump-childrens-everywhere/dp/B0FFZD7D12/ref=sr_1_1?crid=2PE5ZR31RUKFJ&dib=eyJ2IjoiMSJ9.eirXTPVo6volOV0M2LSzWYM7M7OETpDHtuB5kCsvMqZpHjvNE3fvrGYiQzi9OEE_KnGVoDwiK8TJUKsihTlWlEkYrzfe4QfSs8rE6vaoo0Y5BfWqKzpuFPGm7bKE9IC-Kz-0FvP462KBgxOa04D1aqfLppMInjk90QDppqNon6eTrQ0InDpeNmty3hB14QayZjes0oEcHGgvSH_4mtoM9SHyIbK9wzspljEyRdN_vAiF9SAFTutLx3FZqHy8JM44s5QDZ0XdYakBff_dMR3KMvFf10ZCsMFhMmGz6QY5jPI.EkEaYpKKTbUyJ3uJZG_vjHaGCtcX2MSHyN27dyNdIqY&dib_tag=se&keywords=sugarlump&qid=1752536576&sprefix=sugarlump%2Caps%2C158&sr=8-1'">Go to Book</button>

  <script>
    const modelViewer = document.querySelector('model-viewer');
    modelViewer.addEventListener('ar-status', (event) => {
      if (event.detail.status === 'session-started') {
        document.getElementById('url-button').style.display = 'block';
      } else {
        document.getElementById('url-button').style.display = 'none';
      }
    });
  </script>
</body>
</html> -->
